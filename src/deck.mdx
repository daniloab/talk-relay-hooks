import { Head, Image, Appear } from 'mdx-deck'
import Code from 'mdx-code';
import { CodeSurfer } from "mdx-deck-code-surfer";

import { Cover } from './Cover';
import { Intro } from './Intro';
import { Img } from './Img';
import { Thanks } from './Thanks';
import { Feedback } from './Feedback';

export { default as theme } from './theme'

<Head>
  <title>Relay Hooks</title>
</Head>

<Cover />
---
<Intro />

---
## Why Relay

- declarative data
- data fetching
- colocation

---
## Case
<Img src="./img/mobile1.png" width="512" height="512"/>

---
## Case
<Img src="./img/mobile2.png" width="512" height="512"/>

---
## Case
<Img src="./img/mobile3.png" width="60%" />

---
## Benefits and Caveats
<ul>
    <Appear>
        <li>
            Simple Code
        </li>
        <li>
            Better UI Experience
        </li>
        <li>
            Opposed to HOCs
        </li>
        <li>
            React Concurrent Mode and Suspense
        </li>
    </Appear>
</ul>

---
## React Concurrent Mode

<ul>
    <Appear>
        <li>
            What is
        </li>
        <li>
            Interruptible Rendering
        </li>
        <li>
            Intentional Loading
        </li>
        <li>
            Still using react normally: state, props, hooks
        </li>
    </Appear>
</ul>

---
## Suspense

<ul>
    <Appear>
        <li>
            What is
        </li>
        <li>
            Mechanism, not library
        </li>
        <li>
            What not to do
        </li>
        <li>
            What Suspense do
        </li>
    </Appear>
</ul>

---
<CodeSurfer
  title="Suspense"
  code={require('!raw-loader!./code/Suspense.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "component that lets you “wait” for some code to load" },
  ]}
/>


---
<CodeSurfer
  title="Error Boundary"
  code={require('!raw-loader!./code/ErrorBoundary.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "React component to catch javascript errors anywhere" },
  ]}
/>

---
## Relay Hooks
<ul>
    <li>
        RelayEnvironmentProvider
    </li>
    <li>
        useRelayEnvironment
    </li>
    <li>
        usePreloadedQuery
    </li>
    <li>
        useLazyLoadQuery
    </li>
    <li>
        useFragment
    </li>
    <li>
        useRefetchableFragment
    </li>
    <li>
        usePaginationFragment
    </li>
</ul>

---
<CodeSurfer
  title="RelayEnvironmentProvider"
  code={require('!raw-loader!./code/hooks/RelayEnvironmentProvider.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "RelayEnvironmentProvider will wrap our app setting the environment on React Context" },
  ]}
/>

---
<CodeSurfer
  title="useRelayEnvironment"
  code={require('!raw-loader!./code/hooks/useRelayEnvironment.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "Hook used to access a Relay environment that was set by a RelayEnvironmentProvider" },
  ]}
/>

---
<CodeSurfer
  title="usePreloadedQuery"
  code={require('!raw-loader!./code/hooks/usePreloadedQuery.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "Hook used to access data fetched by an earlier call to preloadQuery()." },
    { range: [3, 12], notes: "This implements the 'Render-as-You-Fetch' pattern" },
    { range: [13, 20], notes: "We set on the hook" },
    { range: [21, 35], notes: "Component" },
  ]}
/>

---
<CodeSurfer
  title="useLazyLoadQuery"
  code={require('!raw-loader!./code/hooks/useLazyLoadQuery.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "Hook used to fetch a GraphQL query during render." },
    { range: [2, 15], notes: "We set on the hook" },
    { range: [15, 25], notes: "Component" },
  ]}
/>

---
<CodeSurfer
  title="useFragment"
  code={require('!raw-loader!./code/hooks/useFragment.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "Hook used to fetch a GraphQL query during render." },
    { range: [1, 3], notes: "Props" },
    { range: [6, 16], notes: "useFragment" },
    { range: [17, 27], notes: "useFragment" },
  ]}
/>

---
<CodeSurfer
  title="useRefetchableFragment"
  code={require('!raw-loader!./code/hooks/useRefetchableFragment.tsx')}
  showNumbers={false}
  dark={true}
  lang="jsx"
  steps={[
    { notes: "You can use useRefetchableFragment when you want to fetch and re-render a fragment with different data" },
    { range: [1, 3], notes: "Props" },
    { range: [6, 20], notes: "useFragment" },
    { range: [21, 40], notes: "useFragment" },
  ]}
/>

---
## Real Application

---
## References

- https://relay.dev/
- https://reactjs.org/
- https://reactjs.org/docs/concurrent-mode-intro.html
- https://reactjs.org/docs/concurrent-mode-suspense.html
- https://github.com/relayjs/relay-examples
- https://relay-modern-course.now.sh/packages/

---
<Thanks />
---
<Feedback />